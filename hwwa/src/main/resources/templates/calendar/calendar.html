<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Kalender</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/table.css}">
  <link rel="stylesheet" th:href="@{/css/input_fields_and_icons.css}">
  <link rel="stylesheet" th:href="@{/css/cards.css}">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css">
</head>

<body class="app-body">

<div th:insert="~{fragments/header :: siteHeader}"></div>

<main class="flex-grow-1 app-main">
  <div class="container-xxl py-4">

    <div class="page-header mb-4">
      <div class="d-flex justify-content-between align-items-start gap-3">
        <div>
          <h1>Kalender</h1>
          <p class="mb-0">Persönlicher Kalender (nur zugewiesene Tasks) + Feiertage</p>
          <p class="text-muted mb-0">
            Zeitraum:
            <span th:text="${rangeStart}">2026-01-01</span>
            –
            <span th:text="${rangeEndExclusive}">2026-01-08</span>
            (exklusiv)
          </p>
        </div>

        <div class="d-flex flex-wrap gap-2 justify-content-end">
          <a th:href="@{/calendar(view='day', date=${date})}"
             class="btn btn-outline-secondary"
             th:classappend="${view=='day'} ? 'active'">Tag</a>
          <a th:href="@{/calendar(view='week', date=${date})}"
             class="btn btn-outline-secondary"
             th:classappend="${view=='week'} ? 'active'">Woche</a>
          <a th:href="@{/calendar(view='month', date=${date})}"
             class="btn btn-outline-secondary"
             th:classappend="${view=='month'} ? 'active'">Monat</a>
        </div>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">

        <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
          <div class="text-muted small">
            Legende
          </div>
          <div class="d-flex flex-wrap gap-3 small">
            <div class="d-flex align-items-center gap-2">
              <span class="rounded" style="width:12px;height:12px;background:#0d6efd;display:inline-block;"></span>
              <span>Task</span>
            </div>
            <div class="d-flex align-items-center gap-2">
              <span class="rounded" style="width:12px;height:12px;background:#6c757d;display:inline-block;"></span>
              <span>Feiertag</span>
            </div>
          </div>
        </div>

        <div id="calendar"></div>
      </div>
    </div>

  </div>
</main>

<div th:insert="~{fragments/footer :: siteFooter}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.11/index.global.min.js"></script>

<script th:inline="javascript">
  const initialView = /*[[${initialView}]]*/ 'timeGridWeek';
  const initialDate = /*[[${date}]]*/ '2026-01-01';

  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendar');

    const plugins = [];
    if (window.FullCalendarBootstrap5) {
      plugins.push(window.FullCalendarBootstrap5);
    }

    const calendar = new FullCalendar.Calendar(calendarEl, {
      plugins: plugins,
      themeSystem: 'bootstrap5',

      initialView: initialView,
      initialDate: initialDate,

      firstDay: 1,
      nowIndicator: true,
      height: 'auto',
      expandRows: true,

      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },

      buttonText: {
        today: 'Heute',
        month: 'Monat',
        week: 'Woche',
        day: 'Tag'
      },

      events: {
        url: '/api/calendar/events'
      },

      eventClick: function(info) {
        info.jsEvent.preventDefault();
        if (info.event.url) {
          window.location.href = info.event.url;
        }
      }
    });

    calendar.render();
  });
</script>

</body>
</html>